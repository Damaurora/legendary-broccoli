# Damask Shop

Современный интернет-магазин для вейп-продукции с расширенной админ-панелью и интеграцией с Google Sheets.

## Функциональность

- Каталог товаров с фильтрацией по категориям, брендам и наличию
- Детальные страницы товаров с характеристиками
- Проверка возраста для соответствия законодательству
- Продвинутая админ-панель для управления товарами
- Динамические характеристики товаров в зависимости от категории (жидкости, под-системы, одноразовые устройства)
- Интеграция с Google Sheets для синхронизации остатков товаров

## Технологии

- **Frontend**: React, TypeScript, Tailwind CSS, ShadCN UI, Tanstack Query
- **Backend**: Express.js, Node.js
- **База данных**: PostgreSQL, Drizzle ORM
- **Аутентификация**: Passport.js, Express-session

## Установка и настройка

### Требования

- Node.js 18+ и npm
- PostgreSQL

### Шаги установки

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/username/damask-shop.git
   cd damask-shop
   ```

2. Установить зависимости:
   ```bash
   npm install
   ```

3. Настроить переменные окружения:
   Создайте файл `.env` в корне проекта со следующими переменными:
   ```
   DATABASE_URL=postgresql://username:password@localhost:5432/damaskdb
   SESSION_SECRET=your-secret-key
   ```

4. Применить миграции базы данных:
   ```bash
   npm run db:push
   ```

5. Запустить сервер разработки:
   ```bash
   npm run dev
   ```

6. Доступ к приложению будет по адресу http://localhost:5000

## Доступ к админ-панели

Админ-панель доступна по адресу `/admin`. По умолчанию создается администратор:
- Логин: `admin`
- Пароль: `admin123`

Рекомендуется изменить пароль администратора после первого входа.

## Структура проекта

```
.
├── client/               # Frontend приложение
│   ├── src/
│   │   ├── components/   # UI компоненты
│   │   ├── hooks/        # React хуки
│   │   ├── lib/          # Вспомогательные функции
│   │   ├── pages/        # Страницы приложения
│   │   └── App.tsx       # Корневой компонент
├── server/               # Backend сервер
│   ├── index.ts          # Точка входа сервера
│   ├── routes.ts         # API маршруты
│   ├── auth.ts           # Аутентификация
│   ├── storage.ts        # Интерфейс хранилища
│   └── db.ts             # Настройка базы данных
├── shared/               # Общий код
│   └── schema.ts         # Схема базы данных
├── scripts/              # Скрипты
└── package.json          # Зависимости проекта
```

## Деплой на Render

Для деплоя на Render.com следуйте этим шагам:

1. Создайте аккаунт на [Render.com](https://render.com)

2. Нажмите кнопку "New +" и выберите "Web Service"

3. Подключите ваш GitHub репозиторий или используйте "Deploy from GitHub"

4. Настройте сервис:
   - **Name**: damask-shop (или выберите своё имя)
   - **Environment**: Node
   - **Build Command**: `bash scripts/render-build.sh`
   - **Start Command**: `npm run start`
   - **Plan**: Free

   > **Важно**: Используем свой скрипт сборки, который гарантирует установку всех dev-зависимостей, необходимых для компиляции

5. Нажмите "Create Web Service"

6. После создания сервиса, перейдите в раздел "PostgreSQL" в боковом меню Render

7. Создайте новую PostgreSQL базу данных:
   - **Name**: damask-db (или выберите своё имя)
   - **Plan**: Free (или подходящий план)

8. После создания базы данных, скопируйте "Internal Database URL" из настроек базы

9. Вернитесь к вашему веб-сервису и перейдите в раздел "Environment"

10. Добавьте следующие переменные окружения:
    - `DATABASE_URL`: [скопированный URL базы данных]
    - `SESSION_SECRET`: [любая случайная строка]
    - `NODE_ENV`: production

11. Нажмите "Save Changes" и дождитесь перезапуска сервиса

Ваше приложение будет доступно по URL, который предоставит Render.

### Решение проблем с деплоем

Если у вас возникают проблемы при деплое на Render, проверьте следующее:

1. **Ошибка "Cannot find package '@vitejs/plugin-react'":**
   - Убедитесь, что используете скрипт сборки `scripts/render-build.sh`, который явно устанавливает dev-зависимости
   - Возможно, потребуется изменить настройки зависимостей в Render (см. вкладку "Advanced" в настройках сервиса)

2. **Ошибка "DATABASE_URL must be set":**
   - Проверьте, что вы создали базу данных PostgreSQL в Render
   - Убедитесь, что переменная окружения `DATABASE_URL` добавлена в настройки сервиса
   - URL должен иметь формат `postgres://username:password@host:port/database`

3. **Ошибка "Exited with status 1":**
   - Проверьте логи деплоя на Render для получения более подробной информации
   - Убедитесь, что все необходимые переменные окружения установлены
   - Проверьте, что скрипты имеют права на выполнение (`chmod +x scripts/*.sh`)

### Другие платформы

Также для деплоя подходят:
- **Railway**: Простой деплой с автоматической настройкой базы данных
- **Fly.io**: Глобальное распределение и бесплатный уровень
- **Vercel + Supabase**: Vercel для фронтенда + Supabase для базы данных

## Лицензия

MIT