# Damask Shop

Современный интернет-магазин для вейп-продукции с расширенной админ-панелью и интеграцией с Google Sheets.

## Функциональность

- Каталог товаров с фильтрацией по категориям, брендам и наличию
- Детальные страницы товаров с характеристиками
- Проверка возраста для соответствия законодательству
- Продвинутая админ-панель для управления товарами
- Динамические характеристики товаров в зависимости от категории (жидкости, под-системы, одноразовые устройства)
- Интеграция с Google Sheets для синхронизации остатков товаров

## Технологии

- **Frontend**: React, TypeScript, Tailwind CSS, ShadCN UI, Tanstack Query
- **Backend**: Express.js, Node.js
- **База данных**: PostgreSQL, Drizzle ORM
- **Аутентификация**: Passport.js, Express-session

## Установка и настройка

### Требования

- Node.js 18+ и npm
- PostgreSQL

### Шаги установки

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/username/damask-shop.git
   cd damask-shop
   ```

2. Установить зависимости:
   ```bash
   npm install
   ```

3. Настроить переменные окружения:
   Создайте файл `.env` в корне проекта со следующими переменными:
   ```
   DATABASE_URL=postgresql://username:password@localhost:5432/damaskdb
   SESSION_SECRET=your-secret-key
   ```

4. Применить миграции базы данных:
   ```bash
   npm run db:push
   ```

5. Запустить сервер разработки:
   ```bash
   npm run dev
   ```

6. Доступ к приложению будет по адресу http://localhost:5000

## Доступ к админ-панели

Админ-панель доступна по адресу `/admin`. По умолчанию создается администратор:
- Логин: `admin`
- Пароль: `admin123`

Рекомендуется изменить пароль администратора после первого входа.

## Структура проекта

```
.
├── client/               # Frontend приложение
│   ├── src/
│   │   ├── components/   # UI компоненты
│   │   ├── hooks/        # React хуки
│   │   ├── lib/          # Вспомогательные функции
│   │   ├── pages/        # Страницы приложения
│   │   └── App.tsx       # Корневой компонент
├── server/               # Backend сервер
│   ├── index.ts          # Точка входа сервера
│   ├── routes.ts         # API маршруты
│   ├── auth.ts           # Аутентификация
│   ├── storage.ts        # Интерфейс хранилища
│   └── db.ts             # Настройка базы данных
├── shared/               # Общий код
│   └── schema.ts         # Схема базы данных
├── scripts/              # Скрипты
└── package.json          # Зависимости проекта
```

## Деплой

### Метод 1: Обычный деплой на Render

Для деплоя на Render.com следуйте этим шагам:

1. Создайте аккаунт на [Render.com](https://render.com)

2. Нажмите кнопку "New +" и выберите "Web Service"

3. Подключите ваш GitHub репозиторий или используйте "Deploy from GitHub"

4. Настройте сервис:
   - **Name**: damask-shop (или выберите своё имя)
   - **Environment**: Node
   - **Build Command**: `chmod +x render-build.sh && ./render-build.sh`
   - **Start Command**: `npm run start`
   - **Plan**: Free

   > **Важно**: 
   > 1. Используем специальный bash-скрипт `render-build.sh` для преодоления проблем с зависимостями
   > 2. В разделе "Advanced Options" включите опцию "Include Development Dependencies"
   > 3. Скрипт явно устанавливает все необходимые dev-зависимости и запускает сборку в нужном порядке

5. Нажмите "Create Web Service"

6. После создания сервиса, перейдите в раздел "PostgreSQL" в боковом меню Render

7. Создайте новую PostgreSQL базу данных:
   - **Name**: damask-db (или выберите своё имя)
   - **Plan**: Free (или подходящий план)

8. После создания базы данных, скопируйте "Internal Database URL" из настроек базы

9. Вернитесь к вашему веб-сервису и перейдите в раздел "Environment"

10. Добавьте следующие переменные окружения:
    - `DATABASE_URL`: [скопированный URL базы данных]
    - `SESSION_SECRET`: [любая случайная строка]
    - `NODE_ENV`: production

11. Нажмите "Save Changes" и дождитесь перезапуска сервиса

Ваше приложение будет доступно по URL, который предоставит Render.

### Метод 2: Статическая сборка для Render (рекомендуется)

Если у вас возникают проблемы с зависимостями, используйте метод со статической сборкой:

1. **Локально** соберите проект:
   ```bash
   # Сделайте скрипт исполняемым
   chmod +x build-for-deploy.sh
   
   # Запустите сборку
   ./build-for-deploy.sh
   ```

2. Убедитесь, что директория `dist` создана и добавлена в Git:
   ```bash
   git add dist
   git commit -m "Add production build"
   git push
   ```

3. На Render настройте сервис:
   - **Name**: damask-shop (или любое другое имя)
   - **Environment**: Node
   - **Build Command**: `chmod +x start-render.sh`
   - **Start Command**: `./start-render.sh`
   - **Plan**: Free

   > **Важно**: 
   > 1. В директории `dist` уже содержатся предварительно собранные файлы
   > 2. Скрипт `start-render.sh` просто устанавливает production зависимости и запускает приложение
   > 3. Этот метод не требует опции "Include Development Dependencies"

4. Настройте базу данных и переменные окружения так же, как в методе 1.

### Решение проблем с деплоем

Если у вас возникают проблемы при деплое на Render, проверьте следующее:

1. **Ошибка "Cannot find package '@vitejs/plugin-react'":**
   - Убедитесь, что используете команду сборки `chmod +x render-build.sh && ./render-build.sh` 
   - Скрипт `render-build.sh` явно устанавливает все необходимые dev-зависимости
   - В настройках Render на вкладке "Advanced" включите опцию "Include Development Dependencies"
   - **Рекомендуемое решение**: Используйте Метод 2 со статической сборкой, который описан выше

2. **Ошибка "DATABASE_URL must be set":**
   - Проверьте, что вы создали базу данных PostgreSQL в Render
   - Убедитесь, что переменная окружения `DATABASE_URL` добавлена в настройки сервиса
   - URL должен иметь формат `postgres://username:password@host:port/database`

3. **Ошибка "Exited with status 1":**
   - Проверьте логи деплоя на Render для получения более подробной информации
   - Убедитесь, что все необходимые переменные окружения установлены
   - Проверьте, что скрипты имеют права на выполнение (`chmod +x scripts/*.sh`)

### Метод 3: Экстренное решение (временная страница)

Если вам срочно нужно запустить хотя бы простую страницу на Render, используйте режим заглушки:

1. Запустите скрипт для создания простого проекта:
   ```bash
   node simple-render-deploy.js
   ```

2. Добавьте созданные файлы в Git:
   ```bash
   git add server.js package.json public/
   git commit -m "Add simple deployment files"
   git push
   ```

3. На Render настройте сервис:
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`

4. В течение минуты у вас будет работающая страница-заглушка, информирующая клиентов о режиме обслуживания.

### Другие платформы

Также для деплоя подходят:
- **Railway**: Простой деплой с автоматической настройкой базы данных
- **Fly.io**: Глобальное распределение и бесплатный уровень
- **Vercel + Supabase**: Vercel для фронтенда + Supabase для базы данных

## Лицензия

MIT